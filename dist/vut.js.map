{"version":3,"file":"vut.js","sources":["../src/util.js","../src/vut.js"],"sourcesContent":["import Vut from './vut'\n\nconst util = {\n  isObject (obj) {\n    return !!obj && Object.prototype.toString.call(obj) === '[object Object]'\n  },\n  error (msg) {\n    throw new Error(`[vut] ${msg}`)\n  },\n  has (obj, attr) {\n    return Object.prototype.hasOwnProperty.call(obj, attr)\n  },\n  pathCompression (obj, options) {\n    Object.keys(options).forEach(k => {\n      Object.defineProperty(obj, k, {\n        get () {\n          return options[k]\n        },\n        set (val) {\n          options[k] = val\n        }\n      })\n    })\n  },\n  getModule (vut, paths, fn) {\n    if (typeof paths === 'string') {\n      if (!util.has(vut.modules, paths)) {\n        util.error(`Module '${paths}' does not exist`)\n      }\n      return fn(vut.modules[paths])\n    } else if (util.isObject(paths)) {\n      const data = {}\n      Object.keys(paths).forEach(name => {\n        if (!util.has(vut.modules, name)) {\n          util.error(`Module '${paths[name]}' does not exist`)\n        }\n        data[name] = fn(vut.modules[paths[name]])\n      })\n      return data\n    }\n    util.error(`The parameter is illegal. Please use 'vut.getModule(path: string)' or 'vut.getModule({ [path: string]: string })'`)\n  },\n  callModuleHook (vut, goods, name, ...arg) {\n    const mixins = Vut\n      .options\n      .plugins\n      .filter(plugin => {\n        return util.isObject(plugin.module)\n      })\n      .map(plugin => plugin.module)\n    mixins.forEach(mixin => {\n      if (!util.has(mixin, name)) return\n      mixin[name].apply(goods, arg)\n    })\n  },\n  callInstanceHook (vut, name, ...arg) {\n    const mixins = Vut\n      .options\n      .plugins\n      .filter(plugin => {\n        return util.isObject(plugin.instance)\n      })\n      .map(plugin => plugin.instance)\n    mixins.forEach(mixin => {\n      if (!util.has(mixin, name)) return\n      mixin[name].apply(vut, arg)\n    })\n  }\n}\n\nexport default util\n","import util from './util'\n\nlet isUse = false\n\nclass Vut {\n  constructor (options) {\n    this.modules = {}\n    this.plugins = []\n    util.callInstanceHook(this, 'beforeCreate')\n    util.callInstanceHook(this, 'created')\n    isUse = true\n  }\n  addModules (path, moduleOptions) {\n    if (typeof path !== 'string') {\n      util.error(`'path=${path}' not is string type`)\n    }\n    if (!path) {\n      util.error(`'path' not is null string`)\n    }\n    if (!util.isObject(moduleOptions)) {\n      util.error(`${path} 'options' not is object type`)\n    }\n    if (util.isObject(moduleOptions.modules)) {\n      Object.keys(moduleOptions.modules).forEach(k => {\n        this.addModules(`${path}/${k}`, moduleOptions.modules[k])\n      })\n    }\n    if (util.has(this.modules, path)) {\n      util.error(`'${path}' already is in module`)\n    }\n    if (typeof moduleOptions.data !== 'function') {\n      util.error(`'${path}' not is function type`)\n    }\n    const goods = Object.create(null)\n    goods.$options = moduleOptions\n    goods.$context = this\n    util.callModuleHook(this, goods, 'beforeCreate')\n\n    // Bind action\n    goods.$actions = {}\n    Object.keys(goods.$options).forEach(fnName => {\n      if (typeof goods.$options[fnName] !== 'function') return\n      goods.$actions[fnName] = function action () {\n        util.callModuleHook(this, goods, 'beforeAction', fnName)\n        const res = goods.$options[fnName].apply(goods, arguments)\n        util.callModuleHook(this, goods, 'actioned', fnName, res)\n        return res\n      }\n    })\n\n    // Bind state\n    goods.$state = goods.$actions.data()\n    if (!util.isObject(goods.$state)) {\n      util.error(`'vut.getAction(${path}).data()' return value not is object type`)\n    }\n\n    // Path compression\n    util.pathCompression(goods, goods.$actions)\n    util.pathCompression(goods, goods.$state)\n\n    this.modules[path] = goods\n    util.callModuleHook(this, goods, 'created')\n    return this\n  }\n  getModule (paths) {\n    return util.getModule(this, paths, goods => goods)\n  }\n  getState (paths) {\n    return util.getModule(this, paths, goods => goods.$state)\n  }\n  getActions (paths) {\n    return util.getModule(this, paths, goods => goods.$actions)\n  }\n  destroy () {\n    util.callInstanceHook(this, 'beforeDestroy')\n    Object.keys(this.modules).forEach(path => {\n      const goods = this.modules[path]\n      util.callModuleHook(this, goods, 'beforeDestroy')\n      util.callModuleHook(this, goods, 'destroyed')\n    })\n    util.callInstanceHook(this, 'destroyed')\n    return this\n  }\n}\n\nObject.assign(Vut, {\n  options: {\n    plugins: []\n  },\n  use (plugin) {\n    if (!util.isObject(plugin)) {\n      util.error(`plugin not is object type`)\n    }\n    if (isUse) {\n      return util.error(`'Vut.use(plugin)' must in 'new Vut()' before`)\n    }\n    this.options.plugins.push(plugin)\n    return this\n  }\n})\n\nexport default Vut\n"],"names":["util","obj","Object","prototype","toString","call","msg","Error","attr","hasOwnProperty","options","keys","forEach","defineProperty","k","val","vut","paths","fn","has","modules","error","isObject","data","name","goods","arg","mixins","Vut","plugins","filter","plugin","module","map","mixin","apply","instance","isUse","callInstanceHook","path","moduleOptions","addModules","create","$options","$context","callModuleHook","$actions","fnName","action","res","arguments","$state","pathCompression","getModule","assign","push"],"mappings":"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"}